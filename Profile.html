    <!DOCTYPE html>
    <html lang="th">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Scan Check-in | สมัครสมาชิก</title>
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
        <link rel="stylesheet" href="/CSS/Profle.css">
    </head>
    <body>
        <!-- Background Pattern -->
        <div class="background-pattern">
            <div class="pattern-grid"></div>
            <div class="floating-elements">
                <div class="floating-element element-1"></div>
                <div class="floating-element element-2"></div>
                <div class="floating-element element-3"></div>
                <div class="floating-element element-4"></div>
                <div class="floating-element element-5"></div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <div class="nav-logo">
                        <ion-icon name="scan-outline"></ion-icon>
                    </div>
                    <span class="nav-title">Scan Check-in</span>
                </div>
                    <a href="/HTML/help.html" class="nav-link">
                        <ion-icon name="help-circle-outline"></ion-icon>
                        <span>ช่วยเหลือ</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Container -->
        <main class="main-container">
            <!-- Left Side - Information -->
            <div class="info-section">
                <div class="info-content">
                    <div class="info-header">
                        <div class="info-icon">
                            <ion-icon name="scan-circle-outline"></ion-icon>
                        </div>
                        <h1 class="info-title">ระบบเช็คอินอัตโนมัติ</h1>
                        <p class="info-subtitle">เทคโนโลยีที่ทันสมัยสำหรับการจัดการการเข้าเรียน</p>
                    </div>
                    
                    <div class="features-list">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <ion-icon name="flash-outline"></ion-icon>
                            </div>
                            <div class="feature-content">
                                <h3>เช็คอินรวดเร็ว</h3>
                                <p>สแกน QR Code หรือใช้ระบบสแกนใบหน้าเพื่อเข้าสู่ระบบได้ทันที</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon">
                                <ion-icon name="shield-checkmark-outline"></ion-icon>
                            </div>
                            <div class="feature-content">
                                <h3>ความปลอดภัยสูง</h3>
                                <p>ระบบรักษาความปลอดภัยขั้นสูงด้วยการเข้ารหัสข้อมูล</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon">
                                <ion-icon name="analytics-outline"></ion-icon>
                            </div>
                            <div class="feature-content">
                                <h3>รายงานแบบเรียลไทม์</h3>
                                <p>ติดตามสถิติการเข้าเรียนและวิเคราะห์ข้อมูลได้ทันที</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Forms -->
            <div class="login-section">
                <!-- Login Form -->
                <div class="login-container" id="loginContainer">
                    <div class="login-header">
                        <div class="login-icon">
                            <ion-icon name="person-circle-outline"></ion-icon>
                        </div>
                        <h2 class="login-title">เข้าสู่ระบบ</h2>
                        <p class="login-subtitle">กรุณาป้อนข้อมูลเพื่อเข้าใช้งานระบบ</p>
                    </div>

                    <form class="login-form" id="loginForm">
                        <div class="form-group">
                            <label for="username" class="form-label">ชื่อผู้ใช้งาน</label>
                            <div class="input-container">
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                <input type="text" id="username" name="username" class="form-input" 
                                    placeholder="กรอกชื่อผู้ใช้งาน" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="password" class="form-label">รหัสผ่าน</label>
                            <div class="input-container">
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                                <input type="password" id="password" name="password" class="form-input" 
                                    placeholder="กรอกรหัสผ่าน" required>
                                <button type="button" class="password-toggle" id="passwordToggle">
                                    <ion-icon name="eye-outline" id="toggleIcon"></ion-icon>
                                </button>
                            </div>
                        </div>

                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="remember" name="remember">
                                <span class="checkmark"></span>
                                <span class="checkbox-text">จดจำการเข้าสู่ระบบ</span>
                            </label>
                            <a href="#" class="forgot-link" onclick="toggleForm('forgot')">ลืมรหัสผ่าน?</a>
                        </div>

                        <button type="submit" class="login-btn">
                            <span class="btn-text">เข้าสู่ระบบ</span>
                            <ion-icon name="arrow-forward-outline" class="btn-icon"></ion-icon>
                        </button>

                        <div class="divider">
                            <span class="divider-text">หรือเข้าสู่ระบบด้วย</span>
                        </div>

                        <div class="quick-login">
                            <button type="button" class="quick-btn qr-btn">
                                <ion-icon name="qr-code-outline"></ion-icon>
                                <span>QR Code</span>
                            </button>
                            <button type="button" class="quick-btn face-btn">
                                <ion-icon name="camera-outline"></ion-icon>
                                <span>Face ID</span>
                            </button>
                            <button type="button" class="quick-btn fingerprint-btn">
                                <ion-icon name="finger-print-outline"></ion-icon>
                                <span>Fingerprint</span>
                            </button>
                        </div>
                    </form>

                    <div class="login-footer">
                        <p class="footer-text">
                            ยังไม่มีบัญชี? 
                            <a href="#" onclick="toggleForm('register')" style="color: #667eea; text-decoration: none; font-weight: 600;">
                                สมัครสมาชิก
                            </a>
                        </p>
                    </div>
                </div>

                <!-- Register Form -->
                <div class="login-container" id="registerContainer" style="display: none;">
                    <div class="login-header">
                        <div class="login-icon">
                            <ion-icon name="person-add-outline"></ion-icon>
                        </div>
                        <h2 class="login-title">สมัครสมาชิก</h2>
                        <p class="login-subtitle">กรุณากรอกข้อมูลเพื่อสร้างบัญชีใหม่</p>
                    </div>

                    <form class="login-form" id="registerForm">
                        <!-- Role Selection -->
                        <div class="form-group">
                            <label for="role" class="form-label">ประเภทผู้ใช้งาน</label>
                            <div class="input-container">
                                <ion-icon name="accessibility-outline" class="input-icon"></ion-icon>
                                <select id="role" name="role" class="form-input" required>
                                    <option value="">เลือกประเภทผู้ใช้งาน</option>
                                    <option value="student">นักเรียน</option>
                                    <option value="teacher">ครู</option>
                                </select>
                            </div>
                        </div>

                        <!-- Username -->
                        <div class="form-group">
                            <label for="regUsername" class="form-label">ชื่อผู้ใช้งาน</label>
                            <div class="input-container">
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                <input type="text" id="regUsername" name="username" class="form-input" 
                                    placeholder="กรอกชื่อผู้ใช้งาน" required>
                            </div>
                            <div class="form-hint" id="usernameHint"></div>
                        </div>

                        <!-- Name Fields -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label for="firstName" class="form-label">ชื่อ</label>
                                <div class="input-container">
                                    <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                    <input type="text" id="firstName" name="firstName" class="form-input" 
                                        placeholder="ชื่อจริง" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lastName" class="form-label">นามสกุล</label>
                                <div class="input-container">
                                    <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                    <input type="text" id="lastName" name="lastName" class="form-input" 
                                        placeholder="นามสกุล" required>
                                </div>
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="email" class="form-label">อีเมล</label>
                            <div class="input-container">
                                <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                                <input type="email" id="email" name="email" class="form-input" 
                                    placeholder="example@school.ac.th" required>
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="form-group">
                            <label for="phone" class="form-label">เบอร์โทรศัพท์</label>
                            <div class="input-container">
                                <ion-icon name="call-outline" class="input-icon"></ion-icon>
                                <input type="tel" id="phone" name="phone" class="form-input" 
                                    placeholder="0812345678" required>
                            </div>
                        </div>

                        <!-- Student ID / Teacher ID -->
                        <div class="form-group">
                            <label for="studentId" class="form-label">รหัสประจำตัว</label>
                            <div class="input-container">
                                <ion-icon name="card-outline" class="input-icon"></ion-icon>
                                <input type="text" id="studentId" name="studentId" class="form-input" 
                                    placeholder="กรอกรหัสนักเรียน/ครู" required>
                            </div>
                        </div>

                        <!-- Class -->
                        <div class="form-group">
                            <label for="class" class="form-label">ชั้นเรียน/แผนก</label>
                            <div class="input-container">
                                <ion-icon name="school-outline" class="input-icon"></ion-icon>
                                <input type="text" id="class" name="class" class="form-input" 
                                    placeholder="เช่น 3/1 หรือ แผนกคอมพิวเตอร์" required>
                            </div>
                        </div>

                        <!-- Date of Birth -->
                        <div class="form-group">
                            <label for="birthDate" class="form-label">วันเดือนปีเกิด</label>
                            <div class="input-container">
                                <ion-icon name="calendar-outline" class="input-icon"></ion-icon>
                                <input type="date" id="birthDate" name="birthDate" class="form-input" required>
                            </div>
                        </div>

                        <!-- Password -->
                        <div class="form-group">
                            <label for="regPassword" class="form-label">รหัสผ่าน</label>
                            <div class="input-container">
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                                <input type="password" id="regPassword" name="password" class="form-input" 
                                    placeholder="กรอกรหัสผ่าน (อย่างน้อย 6 ตัวอักษร)" required>
                                <button type="button" class="password-toggle" id="regPasswordToggle">
                                    <ion-icon name="eye-outline" id="regToggleIcon"></ion-icon>
                                </button>
                            </div>
                            <div class="form-hint" id="passwordHint"></div>
                        </div>

                        <!-- Confirm Password -->
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">ยืนยันรหัสผ่าน</label>
                            <div class="input-container">
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                                <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" 
                                    placeholder="ยืนยันรหัสผ่านอีกครั้ง" required>
                                <button type="button" class="password-toggle" id="confirmPasswordToggle">
                                    <ion-icon name="eye-outline" id="confirmToggleIcon"></ion-icon>
                                </button>
                            </div>
                            <div class="form-hint" id="confirmPasswordHint"></div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="acceptTerms" name="acceptTerms" required>
                                <span class="checkmark"></span>
                                <span class="checkbox-text">
                                    ฉันยอมรับ <a href="/HTML/N.html" style="color: #667eea;">เงื่อนไขการใช้งาน</a> 
                                    และ <a href="/HTML/about.html" style="color: #667eea;">นโยบายความเป็นส่วนตัว</a>
                                </span>
                            </label>
                        </div>

                        <button type="submit" class="login-btn">
                            <span class="btn-text">สมัครสมาชิก</span>
                            <ion-icon name="checkmark-outline" class="btn-icon"></ion-icon>
                        </button>
                    </form>

                    <div class="login-footer">
                        <p class="footer-text">
                            มีบัญชีอยู่แล้ว? 
                            <a href="#" onclick="toggleForm('login')" style="color: #667eea; text-decoration: none; font-weight: 600;">
                                เข้าสู่ระบบ
                            </a>
                        </p>
                    </div>
                </div>

                <!-- Forgot Password Form -->
                <div class="login-container" id="forgotContainer" style="display: none;">
                    <div class="login-header">
                        <div class="login-icon">
                            <ion-icon name="key-outline"></ion-icon>
                        </div>
                        <h2 class="login-title">ลืมรหัสผ่าน</h2>
                        <p class="login-subtitle">กรุณากรอกข้อมูลเพื่อยืนยันตัวตน</p>
                    </div>

                    <form class="login-form" id="forgotForm">
                        <!-- Username -->
                        <div class="form-group">
                            <label for="forgotUsername" class="form-label">ชื่อผู้ใช้งาน</label>
                            <div class="input-container">
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                <input type="text" id="forgotUsername" name="username" class="form-input" 
                                    placeholder="กรอกชื่อผู้ใช้งาน" required>
                            </div>
                        </div>

                        <!-- Student ID -->
                        <div class="form-group">
                            <label for="forgotStudentId" class="form-label">รหัสประจำตัว</label>
                            <div class="input-container">
                                <ion-icon name="card-outline" class="input-icon"></ion-icon>
                                <input type="text" id="forgotStudentId" name="studentId" class="form-input" 
                                    placeholder="กรอกรหัสนักเรียน/ครู" required>
                            </div>
                        </div>

                        <!-- Date of Birth -->
                        <div class="form-group">
                            <label for="forgotBirthDate" class="form-label">วันเดือนปีเกิด</label>
                            <div class="input-container">
                                <ion-icon name="calendar-outline" class="input-icon"></ion-icon>
                                <input type="date" id="forgotBirthDate" name="birthDate" class="form-input" required>
                            </div>
                        </div>

                        <button type="submit" class="login-btn">
                            <span class="btn-text">ยืนยันตัวตน</span>
                            <ion-icon name="checkmark-outline" class="btn-icon"></ion-icon>
                        </button>
                    </form>

                    <div class="login-footer">
                        <p class="footer-text">
                            จำรหัสผ่านได้แล้ว? 
                            <a href="#" onclick="toggleForm('login')" style="color: #667eea; text-decoration: none; font-weight: 600;">
                                เข้าสู่ระบบ
                            </a>
                        </p>
                    </div>
                </div>

                <!-- Reset Password Form -->
                <div class="login-container" id="resetContainer" style="display: none;">
                    <div class="login-header">
                        <div class="login-icon">
                            <ion-icon name="refresh-outline"></ion-icon>
                        </div>
                        <h2 class="login-title">ตั้งรหัสผ่านใหม่</h2>
                        <p class="login-subtitle">กรุณากรอกรหัสผ่านใหม่ของคุณ</p>
                    </div>

                    <form class="login-form" id="resetForm">
                        <!-- New Password -->
                        <div class="form-group">
                            <label for="newPassword" class="form-label">รหัสผ่านใหม่</label>
                            <div class="input-container">
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                                <input type="password" id="newPassword" name="newPassword" class="form-input" 
                                    placeholder="กรอกรหัสผ่านใหม่ (อย่างน้อย 6 ตัวอักษร)" required>
                                <button type="button" class="password-toggle" id="newPasswordToggle">
                                    <ion-icon name="eye-outline" id="newToggleIcon"></ion-icon>
                                </button>
                            </div>
                            <div class="form-hint" id="newPasswordHint"></div>
                        </div>

                        <!-- Confirm New Password -->
                        <div class="form-group">
                            <label for="confirmNewPassword" class="form-label">ยืนยันรหัสผ่านใหม่</label>
                            <div class="input-container">
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                                <input type="password" id="confirmNewPassword" name="confirmNewPassword" class="form-input" 
                                    placeholder="ยืนยันรหัสผ่านใหม่อีกครั้ง" required>
                                <button type="button" class="password-toggle" id="confirmNewPasswordToggle">
                                    <ion-icon name="eye-outline" id="confirmNewToggleIcon"></ion-icon>
                                </button>
                            </div>
                            <div class="form-hint" id="confirmNewPasswordHint"></div>
                        </div>

                        <button type="submit" class="login-btn">
                            <span class="btn-text">เปลี่ยนรหัสผ่าน</span>
                            <ion-icon name="save-outline" class="btn-icon"></ion-icon>
                        </button>
                    </form>

                    <div class="login-footer">
                        <p class="footer-text">
                            <a href="#" onclick="toggleForm('login')" style="color: #667eea; text-decoration: none; font-weight: 600;">
                                ← กลับไปเข้าสู่ระบบ
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="loading-spinner">
                    <ion-icon name="reload-outline"></ion-icon>
                </div>
                <h3 id="loadingText">กำลังเข้าสู่ระบบ</h3>
                <p>กรุณารอสักครู่...</p>
            </div>
        </div>

        <!-- Success Modal -->
        <div class="success-modal" id="successModal">
            <div class="modal-content">
                <div class="success-icon">
                    <ion-icon name="checkmark-circle"></ion-icon>
                </div>
                <h3 id="successTitle">เข้าสู่ระบบสำเร็จ!</h3>
                <p id="successMessage">ยินดีต้อนรับสู่ระบบ Scan Check-in</p>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="successPrimaryBtn">
                        <ion-icon name="person-outline"></ion-icon>
                        ไปที่โปรไฟล์
                    </button>
                    <button class="modal-btn secondary" id="successSecondaryBtn">
                        <ion-icon name="home-outline"></ion-icon>
                        หน้าหลัก
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Modal -->
        <div class="error-modal" id="errorModal">
            <div class="modal-content">
                <div class="error-icon">
                    <ion-icon name="alert-circle"></ion-icon>
                </div>
                <h3>เกิดข้อผิดพลาด</h3>
                <p id="errorMessage">ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง</p>
                <div class="modal-actions">
                    <button class="modal-btn primary" id="tryAgain">
                        <ion-icon name="refresh-outline"></ion-icon>
                        ลองอีกครั้ง
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-left">
                    <p>&copy; 2024 Scan Check-in System. สงวนลิขสิทธิ์.</p>
                </div>
                <div class="footer-right">
                    <a href="#" class="footer-link">
                        <ion-icon name="document-text-outline"></ion-icon>
                        นโยบายความเป็นส่วนตัว
                    </a>
                    <a href="#" class="footer-link">
                        <ion-icon name="information-circle-outline"></ion-icon>
                        เงื่อนไขการใช้งาน
                    </a>
                </div>
            </div>
        </footer>

        <script>
            // Extended user database with birth dates
    let userDatabase = {
        'student001': {
            username: 'student001',
            password: 'password123',
            firstName: 'สมชาย',
            lastName: 'ใจดี',
            email: 'somchai@school.ac.th',
            phone: '0812345678',
            studentId: '63010001',
            class: '3/1',
            role: 'student',
            roleDisplay: 'นักเรียน',
            birthDate: '2005-01-15',
            address: '123 ถนนสุขุมวิท แขวงคลองตัน เขตคลองตัน กรุงเทพฯ 10110',
            attendanceRate: 95,
            attendedDays: 42,
            absentDays: 3,
            showOnlineStatus: true,
            emailNotifications: true,
            browserNotifications: false
        },
        'teacher001': {
            username: 'teacher001',
            password: 'teacher123',
            firstName: 'อาจารย์สมหญิง',
            lastName: 'ประเสริฐ',
            email: 'teacher@school.ac.th',
            phone: '0887654321',
            studentId: 'T001',
            class: 'ครูประจำชั้น 3/1',
            role: 'teacher',
            roleDisplay: 'ครู',
            birthDate: '1985-05-20',
            address: '456 ถนนพหลโยธิน เขตจตุจักร กรุงเทพฯ 10900',
            attendanceRate: 98,
            attendedDays: 45,
            absentDays: 1,
            showOnlineStatus: true,
            emailNotifications: true,
            browserNotifications: true
        },
        'admin': {
            username: 'admin',
            password: 'admin123',
            firstName: 'ผู้ดูแลระบบ',
            lastName: 'หลัก',
            email: 'admin@school.ac.th',
            phone: '0898765432',
            studentId: 'ADMIN001',
            class: 'ผู้ดูแลระบบ',
            role: 'admin',
            roleDisplay: 'ผู้ดูแลระบบ',
            birthDate: '1980-12-10',
            address: 'ห้องคอมพิวเตอร์ ชั้น 2 อาคารเรียน',
            attendanceRate: 100,
            attendedDays: 46,
            absentDays: 0,
            showOnlineStatus: true,
            emailNotifications: true,
            browserNotifications: true
        }
    };

    // Load existing users from localStorage if available
    const storedUsers = localStorage.getItem('userDatabase');
    if (storedUsers) {
        userDatabase = { ...userDatabase, ...JSON.parse(storedUsers) };
    }

    // Global variable to store user data for password reset
    let resetUserData = null;

    // Form toggle function
    function toggleForm(formType) {
        const loginContainer = document.getElementById('loginContainer');
        const registerContainer = document.getElementById('registerContainer');
        const forgotContainer = document.getElementById('forgotContainer');
        const resetContainer = document.getElementById('resetContainer');
        
        // Hide all containers
        loginContainer.style.display = 'none';
        registerContainer.style.display = 'none';
        forgotContainer.style.display = 'none';
        resetContainer.style.display = 'none';
        
        // Show selected container
        switch(formType) {
            case 'register':
                registerContainer.style.display = 'block';
                break;
            case 'forgot':
                forgotContainer.style.display = 'block';
                break;
            case 'reset':
                resetContainer.style.display = 'block';
                break;
            default:
                loginContainer.style.display = 'block';
        }
    }

    // Password toggle functionality
    function setupPasswordToggle(passwordId, toggleId, iconId) {
        const toggleButton = document.getElementById(toggleId);
        if (toggleButton) {
            toggleButton.addEventListener('click', function() {
                const passwordInput = document.getElementById(passwordId);
                const toggleIcon = document.getElementById(iconId);
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.name = 'eye-off-outline';
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.name = 'eye-outline';
                }
            });
        }
    }

    // Setup all password toggles
    setupPasswordToggle('password', 'passwordToggle', 'toggleIcon');
    setupPasswordToggle('regPassword', 'regPasswordToggle', 'regToggleIcon');
    setupPasswordToggle('confirmPassword', 'confirmPasswordToggle', 'confirmToggleIcon');
    setupPasswordToggle('newPassword', 'newPasswordToggle', 'newToggleIcon');
    setupPasswordToggle('confirmNewPassword', 'confirmNewPasswordToggle', 'confirmNewToggleIcon');

    // Username validation
    const regUsernameField = document.getElementById('regUsername');
    if (regUsernameField) {
        regUsernameField.addEventListener('input', function() {
            const username = this.value;
            const hint = document.getElementById('usernameHint');
            
            if (username.length === 0) {
                hint.textContent = '';
                hint.style.color = '';
                return;
            }
            
            if (username.length < 4) {
                hint.textContent = 'ชื่อผู้ใช้ต้องมีอย่างน้อย 4 ตัวอักษร';
                hint.style.color = '#ff6b6b';
            } else if (userDatabase[username]) {
                hint.textContent = 'ชื่อผู้ใช้นี้ถูกใช้แล้ว';
                hint.style.color = '#ff6b6b';
            } else {
                hint.textContent = 'ชื่อผู้ใช้พร้อมใช้งาน';
                hint.style.color = '#4ecdc4';
            }
        });
    }

    // Password validation
    const regPasswordField = document.getElementById('regPassword');
    if (regPasswordField) {
        regPasswordField.addEventListener('input', function() {
            const password = this.value;
            const hint = document.getElementById('passwordHint');
            
            if (password.length === 0) {
                hint.textContent = '';
                return;
            }
            
            if (password.length < 6) {
                hint.textContent = 'รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร';
                hint.style.color = '#ff6b6b';
            } else {
                hint.textContent = 'รหัสผ่านแข็งแรง';
                hint.style.color = '#4ecdc4';
            }
            
            // Check confirm password if filled
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (confirmPassword) {
                checkConfirmPassword();
            }
        });
    }

    // Confirm password validation
    function checkConfirmPassword() {
        const password = document.getElementById('regPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const hint = document.getElementById('confirmPasswordHint');
        
        if (confirmPassword.length === 0) {
            hint.textContent = '';
            return;
        }
        
        if (password === confirmPassword) {
            hint.textContent = 'รหัสผ่านตรงกัน';
            hint.style.color = '#4ecdc4';
        } else {
            hint.textContent = 'รหัสผ่านไม่ตรงกัน';
            hint.style.color = '#ff6b6b';
        }
    }

    const confirmPasswordField = document.getElementById('confirmPassword');
    if (confirmPasswordField) {
        confirmPasswordField.addEventListener('input', checkConfirmPassword);
    }

    // New password validation for reset form
    const newPasswordField = document.getElementById('newPassword');
    if (newPasswordField) {
        newPasswordField.addEventListener('input', function() {
            const password = this.value;
            const hint = document.getElementById('newPasswordHint');
            
            if (password.length === 0) {
                hint.textContent = '';
                return;
            }
            
            if (password.length < 6) {
                hint.textContent = 'รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร';
                hint.style.color = '#ff6b6b';
            } else {
                hint.textContent = 'รหัสผ่านแข็งแรง';
                hint.style.color = '#4ecdc4';
            }
            
            // Check confirm password if filled
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            if (confirmNewPassword) {
                checkConfirmNewPassword();
            }
        });
    }

    // Confirm new password validation
    function checkConfirmNewPassword() {
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;
        const hint = document.getElementById('confirmNewPasswordHint');
        
        if (confirmNewPassword.length === 0) {
            hint.textContent = '';
            return;
        }
        
        if (newPassword === confirmNewPassword) {
            hint.textContent = 'รหัสผ่านตรงกัน';
            hint.style.color = '#4ecdc4';
        } else {
            hint.textContent = 'รหัสผ่านไม่ตรงกัน';
            hint.style.color = '#ff6b6b';
        }
    }

    const confirmNewPasswordField = document.getElementById('confirmNewPassword');
    if (confirmNewPasswordField) {
        confirmNewPasswordField.addEventListener('input', checkConfirmNewPassword);
    }

    // Login form submission
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember').checked;
            
            if (username && password) {
                showLoading('กำลังเข้าสู่ระบบ');
                
                setTimeout(() => {
                    hideLoading();
                    
                    const user = userDatabase[username];
                    if (user && user.password === password) {
                        const userData = { ...user };
                        delete userData.password;
                        userData.loginTime = new Date().toISOString();
                        userData.rememberMe = rememberMe;
                        
                        localStorage.setItem('userData', JSON.stringify(userData));
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('userRole', user.role);
                        localStorage.setItem('username', username);
                        
                        showSuccessModal(
                            'เข้าสู่ระบบสำเร็จ!',
                            `ยินดีต้อนรับ ${user.firstName} ${user.lastName}`,
                            'login'
                        );
                    } else {
                        showErrorModal('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
                    }
                }, 2000);
            }
        });
    }

    // Register form submission
    const registerForm = document.getElementById('registerForm');
    if (registerForm) {
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = {
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                studentId: document.getElementById('studentId').value,
                class: document.getElementById('class').value,
                role: document.getElementById('role').value,
                birthDate: document.getElementById('birthDate').value,
                acceptTerms: document.getElementById('acceptTerms').checked
            };
            
            // Validation
            if (!validateRegistrationForm(formData)) {
                return;
            }
            
            showLoading('กำลังสมัครสมาชิก');
            
            setTimeout(() => {
                hideLoading();
                
                // Create new user
                const newUser = {
                    username: formData.username,
                    password: formData.password,
                    firstName: formData.firstName,
                    lastName: formData.lastName,
                    email: formData.email,
                    phone: formData.phone,
                    studentId: formData.studentId,
                    class: formData.class,
                    role: formData.role,
                    birthDate: formData.birthDate,
                    roleDisplay: formData.role === 'student' ? 'นักเรียน' : 'ครู',
                    address: '',
                    attendanceRate: 0,
                    attendedDays: 0,
                    absentDays: 0,
                    showOnlineStatus: true,
                    emailNotifications: true,
                    browserNotifications: false,
                    registrationDate: new Date().toISOString()
                };
                
                // Add to database
                userDatabase[formData.username] = newUser;
                
                // Save to localStorage
                const usersToSave = { ...userDatabase };
                // Remove default users for storage (keep only new registrations)
                delete usersToSave.student001;
                delete usersToSave.teacher001;
                delete usersToSave.admin;
                localStorage.setItem('userDatabase', JSON.stringify(usersToSave));
                
                showSuccessModal(
                    'สมัครสมาชิกสำเร็จ!',
                    `ยินดีต้อนรับ ${formData.firstName} ${formData.lastName} เข้าสู่ระบบ Scan Check-in`,
                    'register'
                );
            }, 2500);
        });
    }

    // Forgot password form submission
    const forgotForm = document.getElementById('forgotForm');
    if (forgotForm) {
        forgotForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('forgotUsername').value;
            const studentId = document.getElementById('forgotStudentId').value;
            const birthDate = document.getElementById('forgotBirthDate').value;
            
            showLoading('กำลังตรวจสอบข้อมูล');
            
            setTimeout(() => {
                hideLoading();
                
                const user = userDatabase[username];
                if (user && user.studentId === studentId && user.birthDate === birthDate) {
                    resetUserData = user;
                    showSuccessModal(
                        'ยืนยันตัวตนสำเร็จ!',
                        'กรุณาตั้งรหัสผ่านใหม่ของคุณ',
                        'forgot'
                    );
                } else {
                    showErrorModal('ข้อมูลไม่ถูกต้อง กรุณาตรวจสอบชื่อผู้ใช้ รหัสประจำตัว และวันเดือนปีเกิดอีกครั้ง');
                }
            }, 2000);
        });
    }

    // Reset password form submission
    const resetForm = document.getElementById('resetForm');
    if (resetForm) {
        resetForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            // Validation
            if (newPassword.length < 6) {
                showErrorModal('รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showErrorModal('รหัสผ่านและการยืนยันรหัสผ่านไม่ตรงกัน');
                return;
            }
            
            if (!resetUserData) {
                showErrorModal('เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง');
                return;
            }
            
            showLoading('กำลังเปลี่ยนรหัสผ่าน');
            
            setTimeout(() => {
                hideLoading();
                
                // Update password in database
                userDatabase[resetUserData.username].password = newPassword;
                
                // Save to localStorage
                const usersToSave = { ...userDatabase };
                // Remove default users for storage (keep only new registrations)
                delete usersToSave.student001;
                delete usersToSave.teacher001;
                delete usersToSave.admin;
                localStorage.setItem('userDatabase', JSON.stringify(usersToSave));
                
                // Clear reset data
                resetUserData = null;
                
                showSuccessModal(
                    'เปลี่ยนรหัสผ่านสำเร็จ!',
                    'คุณสามารถเข้าสู่ระบบด้วยรหัสผ่านใหม่ได้แล้ว',
                    'reset'
                );
            }, 2000);
        });
    }

    // Validation function
    function validateRegistrationForm(data) {
        // Check required fields
        const requiredFields = ['username', 'password', 'firstName', 'lastName', 'email', 'phone', 'studentId', 'class', 'role', 'birthDate'];
        for (let field of requiredFields) {
            if (!data[field]) {
                showErrorModal('กรุณากรอกข้อมูลให้ครบถ้วน');
                return false;
            }
        }
        
        // Check username availability
        if (userDatabase[data.username]) {
            showErrorModal('ชื่อผู้ใช้นี้ถูกใช้แล้ว กรุณาเลือกชื่อใหม่');
            return false;
        }
        
        // Check username length
        if (data.username.length < 4) {
            showErrorModal('ชื่อผู้ใช้ต้องมีอย่างน้อย 4 ตัวอักษร');
            return false;
        }
        
        // Check password length
        if (data.password.length < 6) {
            showErrorModal('รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร');
            return false;
        }
        
        // Check password confirmation
        if (data.password !== data.confirmPassword) {
            showErrorModal('รหัสผ่านและการยืนยันรหัสผ่านไม่ตรงกัน');
            return false;
        }
        
        // Check email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(data.email)) {
            showErrorModal('รูปแบบอีเมลไม่ถูกต้อง');
            return false;
        }
        
        // Check phone format
        const phoneRegex = /^[0-9]{10}$/;
        if (!phoneRegex.test(data.phone.replace(/[-\s]/g, ''))) {
            showErrorModal('รูปแบบเบอร์โทรศัพท์ไม่ถูกต้อง (10 หลัก)');
            return false;
        }
        
        // Check birth date (must be in the past)
        const birthDate = new Date(data.birthDate);
        const today = new Date();
        if (birthDate >= today) {
            showErrorModal('วันเดือนปีเกิดไม่ถูกต้อง');
            return false;
        }
        
        // Check terms acceptance
        if (!data.acceptTerms) {
            showErrorModal('กรุณายอมรับเงื่อนไขการใช้งาน');
            return false;
        }
        
        return true;
    }

    // Modal functions
    function showLoading(text = 'กำลังประมวลผล') {
        document.getElementById('loadingText').textContent = text;
        document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('active');
    }

    // Show success modal
    function showSuccessModal(title, message, type) {
        document.getElementById('successTitle').textContent = title;
        document.getElementById('successMessage').textContent = message;
        
        const primaryBtn = document.getElementById('successPrimaryBtn');
        const secondaryBtn = document.getElementById('successSecondaryBtn');
        
        switch(type) {
            case 'register':
                primaryBtn.innerHTML = '<ion-icon name="log-in-outline"></ion-icon> เข้าสู่ระบบ';
                primaryBtn.onclick = () => {
                    document.getElementById('successModal').classList.remove('active');
                    toggleForm('login');
                };
                secondaryBtn.style.display = 'none';
                break;
            case 'forgot':
                primaryBtn.innerHTML = '<ion-icon name="key-outline"></ion-icon> ตั้งรหัสผ่านใหม่';
                primaryBtn.onclick = () => {
                    document.getElementById('successModal').classList.remove('active');
                    toggleForm('reset');
                };
                secondaryBtn.style.display = 'none';
                break;
            case 'reset':
                primaryBtn.innerHTML = '<ion-icon name="log-in-outline"></ion-icon> เข้าสู่ระบบ';
                primaryBtn.onclick = () => {
                    document.getElementById('successModal').classList.remove('active');
                    toggleForm('login');
                };
                secondaryBtn.style.display = 'none';
                break;
            default: // login
                primaryBtn.innerHTML = '<ion-icon name="home-outline"></ion-icon> หน้าหลัก';
                primaryBtn.onclick = () => window.location.href = '/HTML/index.html';
                
                secondaryBtn.innerHTML = '<ion-icon name="person-outline"></ion-icon> แก้ไขโปรไฟล์';
                secondaryBtn.style.display = 'block';
                secondaryBtn.onclick = () => window.location.href = '/HTML/Nav.html';
        }
        
        document.getElementById('successModal').classList.add('active');
    }

    function showErrorModal(message) {
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorModal').classList.add('active');
    }

    // Modal action buttons
    const tryAgainBtn = document.getElementById('tryAgain');
    if (tryAgainBtn) {
        tryAgainBtn.addEventListener('click', function() {
            document.getElementById('errorModal').classList.remove('active');
        });
    }

    // Quick login buttons
    document.querySelectorAll('.quick-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const type = this.classList.contains('qr-btn') ? 'QR Code' : 
                        this.classList.contains('face-btn') ? 'Face ID' : 'Fingerprint';
            
            showLoading(`กำลังเข้าสู่ระบบด้วย ${type}`);
            setTimeout(() => {
                hideLoading();
                showErrorModal(`การเข้าสู่ระบบด้วย ${type} ยังไม่พร้อมใช้งาน`);
            }, 1500);
        });
    });

    // Input focus animations
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            if (!this.value) {
                this.parentElement.classList.remove('focused');
            }
        });
    });

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('success-modal') || e.target.classList.contains('error-modal')) {
            e.target.classList.remove('active');
        }
    });

    // Auto-redirect if logged in
    document.addEventListener('DOMContentLoaded', function() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        
        if (isLoggedIn === 'true' && userData.rememberMe) {
            window.location.href = '/HTML/index.html';
        }
    });

    // Auto-generate student ID based on role
    const roleField = document.getElementById('role');
    if (roleField) {
        roleField.addEventListener('change', function() {
            const role = this.value;
            const studentIdField = document.getElementById('studentId');
            const studentIdLabel = studentIdField.parentElement.previousElementSibling;
            
            if (role === 'student') {
                studentIdLabel.textContent = 'รหัสนักเรียน';
                studentIdField.placeholder = 'เช่น 67010001';
            } else if (role === 'teacher') {
                studentIdLabel.textContent = 'รหัสครู';
                studentIdField.placeholder = 'เช่น T001';
            } else {
                studentIdLabel.textContent = 'รหัสประจำตัว';
                studentIdField.placeholder = 'กรอกรหัสประจำตัว';
            }
        });
    }

    // Form reset when switching
    function resetForms() {
        const forms = ['loginForm', 'registerForm', 'forgotForm', 'resetForm'];
        forms.forEach(formId => {
            const form = document.getElementById(formId);
            if (form) {
                form.reset();
            }
        });
        
        // Clear hints
        document.querySelectorAll('.form-hint').forEach(hint => {
            hint.textContent = '';
        });
        
        // Clear reset user data
        resetUserData = null;
    }

    // Reset forms when switching between login/register/forgot/reset
    const originalToggleForm = toggleForm;
    toggleForm = function(formType) {
        resetForms();
        originalToggleForm(formType);
    };
        </script>
    </body>
    </html>